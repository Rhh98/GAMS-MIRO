GAMS 31.1.0  r55b6ce3 Released May  1, 2020 WEX-WEI x86 64bit/MS Windows - 07/03/20 10:28:07 Page 1
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
C o m p i l a t i o n


   1  *question about the objective function..
   2   
   3  *$title Case Study : Feed optimizer
      + Validate
      + Tile packing
      + Time window
      + Sponsored stories
      + Random testcase
      + Stochastic value
  12   
  13  *$offsymxref offsymlist offuelxref offuellist offupper
  14   
  21   
  22   
  23  * VARIABLES
  25  set
  26      BIGS    All stories available /s1,s2/
  27      C       User behavior case /c1*c3/;
  29  set
  30      S(BIGS) Filtered stories
  31   
  32  ;
  34  parameter
  35    height(BIGS) 'Stroy height'/s1 20,s2 20/,
  36    width2(BIGS) 'Story width'/s1 20,s2 20/,
  37    valc(BIGS) 'Story base score'/s1 3,s2 2/,
  38    time(BIGS) 'Time when story is available'/s1 500, s2 300/,
  39    sponsored(BIGS) 'Sponsored story'/s1 1,s2 2/,
  40    cscore(BIGS,C) 'Multiplier for story score at different scenarios'/s1*s2.c1*c3 3/;
  41  scalar
  42       totTime   Total time/  1000 /
  43       bHeight   Interface height/  100 /
  44       bWidth    Interface width/  100 /
  45       checkAt   Feed retrieved time /  750 /
  46       window    Time window for freshness/  75 /
  47       oneD      'Dimension of story(1/2)' /  1 /
  48       sponsorRatio Sponsor ratio/ 0.3 /
  49       initRatio Initial ratio/ 0.2 /
  50  ;
  52  parameter
  53    data(BIGS,*),
  54    val(BIGS),
  55    width(BIGS)
  56  ;
  57   
  58   
  59   
  60   
  61  alias(S,T);
  62  alias(BIGS,BIGT);
  63   
  64  positive variable
  65       x(BIGS,C)                 x val of story S in optimal feed
  66       y(BIGS,C)                 y val of story S in optimal feed
  67  ;
  68   
  69  binary variable
  70       left(BIGS,BIGT,C)         S is on left of T
  71       top(BIGS,BIGT,C)          S is on top of T
  72       z(BIGS)                   S is chosen
  73       zc(BIGS,C)                S is chosen in case C
  74       check(BIGS,BIGT,C)        need to check only if both are selected
  75  ;
  76   
  77  free variable
  78       value                   feed's value
  79  ;
  80   
  81  * DATA
  82   
  83  *execseed = 1 + gmillisec(jnow);
  84  option seed = 42 ;
  85   
  86   
  87   
  88   
  89  option reslim = 30;
      height(BIGS) = round(uniform(5,30));
      width(BIGS)  = round(uniform(5,30));
      valc(BIGS)    = height(BIGS)*width(BIGS)*uniform(1,3);
      time(BIGS)   = round(uniform(1,totTime));
      sponsored(BIGS)$(uniform(1,10) ge 7) = 1 ;
      cscore(BIGS,C) = uniform(0,2);
       
  99   
 100  val(BIGS)  = valc(BIGS)*exp(1+(time(BIGS)-(checkAt-window))/totTime);
 101   
 102  data(BIGS,"height") = height(BIGS);
 103   
 104  width(BIGS)=width2(BIGS);
 105   
 106   
 107  data(BIGS,"value")  = val(BIGS);
 108  data(BIGS,"time")   = time(BIGS);
 109   
 110  display cscore;
 111   
 112   
 113   
 114  if ( oneD eq 1 ,
 115   width(BIGS) = bWidth;
 116  );
 117  data(BIGS,"width")  = width(BIGS);
 118  parameter
 119       bigX,
 120       bigY
 121       smallM
 122       littleM
 123  ;
 124   
 125  bigX = bWidth ;
 126  bigY = bHeight ;
 127  smallM = -1 ;
 128   
 129  * FILTER
 130   
 131  S(BIGS) = NO ;
 132  S(BIGT)$(data(BIGT,"height") le bHeight
 133           and data(BIGT,"height") gt 0
 134           and data(BIGT,"width") le bWidth
 135           and data(BIGT,"width") gt 0
 136           and data(BIGT,"time") le checkAt
 137           and data(BIGT,"time") ge (checkAt-window) ) = YES;
 138   
 139  display S;
 140   
 141  * MODEL
 142   
 143  equations
 144    objf,
 145    checkEqn(BIGS,BIGT,C),
 146    overlapEqn(BIGS,BIGT,C),
 147    horLimit(BIGS,BIGT,C),
 148    verLimit(BIGS,BIGT,C),
 149    sponsorEqn(C),
 150    horOrderEqn(BIGS,BIGT,C),
 151    verOrderEqn(BIGS,BIGT,C),
 152    zcEqn(BIGS,C),
 153    selectEqn
 154  ;
 155   
 156  objf..
 157    value =E= SUM(S, z(S)*data(S,"value")) +
 158              SUM(C, 1/CARD(C)*(SUM(S, zc(S,C)*data(S,"value")*cscore(S,C)))) ;
 159   
 160  zcEqn(S,C)..
 161    zc(S,C) =L= 1-z(S);
 162   
 163  checkEqn(S,T,C)$(not diag(S,T))..
 164    z(S) + z(T) + zc(S,C) + zc(T,C) =L= check(S,T,C) + 1;
 165   
 166  overlapEqn(S,T,C)..
 167    (left(S,T,C) + left(T,S,C)+ top(S,T,C) + top(T,S,C)) +
 168    smallM*check(S,T,C) =G= smallM + 1 ;
 169   
 170  horLimit(S,T,C)..
 171    (x(S,C) - x(T,C)) + left(S,T,C)*bigX + bigX*check(S,T,C) =L=
 172    bigX + bigX - data(S,"width") ;
 173   
 174   
 175  verLimit(S,T,C)..
 176    (y(T,C) - y(S,C)) + top(S,T,C)*bigY  + bigY*check(S,T,C) =L=
 177    bigY + bigY - data(T,"height") ;
 178   
 179  littlem = -totTime ;
 180   
 181  horOrderEqn(S,T,C)..
 182    time(S) + littlem*left(S,T,C) =G= time(T) + littlem ;
 183   
 184  verOrderEqn(S,T,C)..
 185    time(S) + littlem*top(S,T,C) =G= time(T) + littlem ;
 186   
 187  sponsorEqn(C)..
 188    SUM(S$(sponsored(S)), z(S)+zc(S,C))  =L= sponsorRatio*SUM(S,z(S)+zc(S,C));
 189   
 190  selectEqn..
 191    SUM(S, z(S)) =G= initRatio*SUM(C,1/CARD(C)*SUM(S,zc(S,C)));
 192   
 193  model feedOptimizer / all /;
 194  x.up(S,C)=bwidth-width(S);
 195  y.up(S,C)=bheight-height(S);
 196  * MIXED INTEGER PROGRAMMING
 197  solve feedOptimizer maximizing value using mip ;
 198   
 199  * POST PROCESS
 200  set resHeader /type,window,value,x,y,z,time,height,width,totalwidth,totalheight,totalval,AreaCover,checkat/;
 202  table result(BIGS,C,resHeader) feed for all scenarios;
 204  result(S,C,"value")     = val(S);
 205  result(S,C,"value")$(result(S,C,"z") eq 2 or result(S,C,"z")  eq 5 )   = cscore(S,C)*val(S);
 206  result(S,C,"x")         = x.L(S,C);
 207  result(S,C,"y")         = y.L(S,C);
 208  result(S,C,"z")         = z.L(S)+zc.L(S,C)*2+sponsored(S)*3;
 209  result(S,C,"height")    = height(S);
 210  result(S,C,"width")     = width(S);
 211  result(S,C,'totalwidth') =bwidth;
 212  result(S,C,'totalheight')=bheight;
 213  result(S,C,'totalval')=value.L;
 214  result(S,C,'checkat')=checkat;
 215  result(S,C,'time')=time(S);
 216  result(S,C,'window')=window;
 217  result(bigS,C,'areacover')$(S(BIGS))=(SUM(S$(z.L(S) > 0.1 or zc.L(S,C)> 0.1),
 218                     height(S)*width(S))/(bHeight*bWidth))*100;
 219  result(S,C,'type')$(result(S,C,"z") ge 3)=3;
 220  result(S,C,'type')$(result(S,C,"z") eq 1)=1;
 221  result(S,C,'type')$(result(S,C,"z") eq 2)=2;
 222  *result(S,"time")      = time(S);
      result(S,C,"x")$(Not x.L(S,C)) = EPS;
      result(S,C,"y")$(Not y.L(S,C)) = EPS;
      result(S,C,"z")$(Not z.L(S) and Not zc.L(S,C)) = EPS;
 228   
 229  display result;
 230   
 231   
 232  display z.L;
 233  display zc.L;
 234   
 235  * END


COMPILATION TIME     =        0.015 SECONDS      3 MB  31.1.0 r55b6ce3 WEX-WEI
GAMS 31.1.0  r55b6ce3 Released May  1, 2020 WEX-WEI x86 64bit/MS Windows - 07/03/20 10:28:07 Page 2
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
E x e c u t i o n


----    110 PARAMETER cscore  Multiplier for story score at different scenarios

            c1          c2          c3

s1       3.000       3.000       3.000
s2       3.000       3.000       3.000


----    139 SET S  Filtered stories

                                                      ( EMPTY )

GAMS 31.1.0  r55b6ce3 Released May  1, 2020 WEX-WEI x86 64bit/MS Windows - 07/03/20 10:28:07 Page 3
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
Equation Listing    SOLVE feedOptimizer Using MIP From line 197


---- objf  =E=  

objf..  value =E= 0 ; (LHS = 0)
     

---- checkEqn  =L=  

                NONE


---- overlapEqn  =G=  

                NONE


---- horLimit  =L=  

                NONE


---- verLimit  =L=  

                NONE


---- sponsorEqn  =L=  

                NONE


---- horOrderEqn  =G=  

                NONE


---- verOrderEqn  =G=  

                NONE


---- zcEqn  =L=  

                NONE


---- selectEqn  =G=  

                NONE

GAMS 31.1.0  r55b6ce3 Released May  1, 2020 WEX-WEI x86 64bit/MS Windows - 07/03/20 10:28:07 Page 4
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
Column Listing      SOLVE feedOptimizer Using MIP From line 197


---- value  feed's value

value
                (.LO, .L, .UP, .M = -INF, 0, +INF, 0)
        1       objf

GAMS 31.1.0  r55b6ce3 Released May  1, 2020 WEX-WEI x86 64bit/MS Windows - 07/03/20 10:28:07 Page 5
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
Model Statistics    SOLVE feedOptimizer Using MIP From line 197


MODEL STATISTICS

BLOCKS OF EQUATIONS          10     SINGLE EQUATIONS            1
BLOCKS OF VARIABLES           1     SINGLE VARIABLES            1
NON ZERO ELEMENTS             1


GENERATION TIME      =        0.032 SECONDS      4 MB  31.1.0 r55b6ce3 WEX-WEI


EXECUTION TIME       =        0.032 SECONDS      4 MB  31.1.0 r55b6ce3 WEX-WEI
GAMS 31.1.0  r55b6ce3 Released May  1, 2020 WEX-WEI x86 64bit/MS Windows - 07/03/20 10:28:07 Page 6
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
Solution Report     SOLVE feedOptimizer Using MIP From line 197


               S O L V E      S U M M A R Y

     MODEL   feedOptimizer       OBJECTIVE  value
     TYPE    MIP                 DIRECTION  MAXIMIZE
     SOLVER  CPLEX               FROM LINE  197

**** SOLVER STATUS     1 Normal Completion         
**** MODEL STATUS      1 Optimal                   
**** OBJECTIVE VALUE                0.0000

 RESOURCE USAGE, LIMIT          0.016        30.000
 ITERATION COUNT, LIMIT         0    2000000000

IBM ILOG CPLEX   31.1.0 r55b6ce3 Released May 01, 2020 WEI x86 64bit/MS Window
--- GAMS/Cplex licensed for continuous and discrete problems.
Cplex 12.10.0.0

Space for names approximately 0.00 Mb
Use option 'names no' to turn use of names off
LP status(1): optimal
Cplex Time: 0.00sec (det. 0.00 ticks)
Optimal solution found.
Objective :           0.000000


                           LOWER          LEVEL          UPPER         MARGINAL

---- EQU objf                .              .              .             1.0000      

---- EQU checkEqn  

                NONE


---- EQU overlapEqn  

                NONE


---- EQU horLimit  

                NONE


---- EQU verLimit  

                NONE


---- EQU sponsorEqn  

                NONE


---- EQU horOrderEqn  

                NONE


---- EQU verOrderEqn  

                NONE


---- EQU zcEqn  

                NONE


                NONE

---- EQU selectEqn                  (EMPTY)

                           LOWER          LEVEL          UPPER         MARGINAL

---- VAR value             -INF             .            +INF             .          

  value  feed's value


**** REPORT SUMMARY :        0     NONOPT
                             0 INFEASIBLE
                             0  UNBOUNDED
GAMS 31.1.0  r55b6ce3 Released May  1, 2020 WEX-WEI x86 64bit/MS Windows - 07/03/20 10:28:07 Page 7
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
E x e c u t i o n


----    229 PARAMETER result  feed for all scenarios

                      ( ALL       0.000 )


----    232 VARIABLE z.L  S is chosen

                      ( ALL       0.000 )


----    233 VARIABLE zc.L  S is chosen in case C

                      ( ALL       0.000 )



EXECUTION TIME       =        0.000 SECONDS      3 MB  31.1.0 r55b6ce3 WEX-WEI


USER: CS526 Advanced Linear Programming              G200210/0001AS-GEN
      Course License UW-Madison, Prof Ferris, Spring 2020        DCE515
      License for teaching and research at degree granting institutions


**** FILE SUMMARY

Input      C:\Users\hasee\Documents\GitHub\GAMS-MIRO\feedopt\feedOptimizer.gms
Output     C:\Users\hasee\Documents\GitHub\GAMS-MIRO\feedopt\feedOptimizer.lst
